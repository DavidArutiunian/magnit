(this["webpackJsonp@magnit/frontend"]=this["webpackJsonp@magnit/frontend"]||[]).push([[14],{310:function(e,t,n){"use strict";n.r(t);var c=n(8),r=n.n(c),a=n(11),s=n(104),o=n(140),u=n(26),i=n(9),j=n(246),b=n(247),f=n(50),O=n(307),m=n(289),l=n(294),p=n(302),d=n(303),g=n(139),h=n(85),k=n(27),x=n.n(k),v=n(0),S=n(35);t.default=function(e){var t=e.users,n=e.username,c=Object(v.useContext)(h.a),k=Object(v.useState)([]),T=Object(u.a)(k,2),E=T[0],F=T[1],R=t.find((function(e){return e.username===n})),w=Object(v.useState)({id:0,title:"",templates:[],stages:[],marketplace:{address:"",city:"",format:"",region:""},status:b.ETaskStatus.DRAFT,idOwner:R?R.id:""}),y=Object(u.a)(w,2),C=y[0],A=y[1],D=Object(v.useState)(!1),I=Object(u.a)(D,2),J=I[0],N=I[1],W=Object(v.useState)({open:!1,message:""}),B=Object(u.a)(W,2),q=B[0],z=B[1],G=Object(v.useState)([]),H=Object(u.a)(G,2),K=H[0],L=H[1],M=Object(v.useState)([]),P=Object(u.a)(M,2),Q=P[0],U=P[1],V=Object(v.useState)([]),X=Object(u.a)(V,2),Y=X[0],Z=X[1],$=Object(v.useState)([]),_=Object(u.a)($,2),ee=_[0],te=_[1];Object(v.useEffect)((function(){Object(S.getTemplates)(c.courier).then((function(e){return F(Object(o.a)(e.templates))})).catch(console.error)}),[c.courier]),Object(v.useEffect)((function(){C.status===b.ETaskStatus.DRAFT&&Object(S.getAllRegions)(c.courier).then((function(e){return L(e.regions)})).catch(console.error)}),[c.courier,C.status]);var ne=(C.marketplace||{}).region,ce=Object(v.useRef)(ne);Object(v.useEffect)((function(){ne&&ce.current!==ne&&Object(S.getCitiesForRegion)(c.courier,ne).then((function(e){return U(e.cities)})).catch(console.error)}),[c.courier,ne]);var re=(C.marketplace||{}).city,ae=Object(v.useRef)(re);Object(v.useEffect)((function(){re&&ne&&ae.current!==re&&Object(S.getFormatsForCity)(c.courier,ne,re).then((function(e){return Z(e.formats)})).catch(console.error)}),[c.courier,ne,re]);var se=(C.marketplace||{}).format,oe=Object(v.useRef)(se);return Object(v.useEffect)((function(){re&&ne&&se&&oe.current!==se&&Object(S.getAddressesForFormat)(c.courier,ne,re,se).then((function(e){return te(e.addresses)})).catch(console.error)}),[c.courier,se,ne,re]),Object(i.jsx)(p.a,null,Object(i.jsx)(d.a,{title:"\u0421\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0437\u0430\u0434\u0430\u043d\u0438\u044f"},Object(i.jsx)(m.a,{item:!0},Object(i.jsx)(j.Button,{variant:"contained",scheme:"blue",css:function(e){return{margin:"0 ".concat(e.spacing(1))}},onClick:function(){Object(S.createTask)(c.courier,C).then(function(){var e=Object(a.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(S.addTemplateAssignment)(c.courier,Number(t.taskId),(C.templates||[]).map(x.a.toNumber)));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).then((function(){return z({open:!0,message:"\u0417\u0430\u0434\u0430\u043d\u0438\u0435 \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u043e!"})})).catch((function(){z({open:!0,message:"\u041e\u0448\u0438\u0431\u043a\u0430 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f \u0437\u0430\u0434\u0430\u043d\u0438\u044f!"}),N(!0)}))},disabled:q.open},Object(i.jsx)(f.SendIcon,null),Object(i.jsx)(l.a,null,"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c")))),Object(i.jsx)(m.a,{css:function(e){return{maxWidth:e.maxTemplateWidth,margin:e.spacing(4),position:"relative",transition:"opacity 0.3s ease-in-out"}}},Object(i.jsx)(O.TaskEditor,{users:t,variant:"create",task:C,templates:E,regions:K,cities:Q,formats:Y,addresses:ee,onTaskChange:function(e){var t;t=e,x.a.has(t,"id")&&x.a.has(t,"title")&&x.a.has(t,"templates")&&A(Object(s.a)({},e))}})),Object(i.jsx)(g.a,{open:q.open,error:J,onClose:function(e,t){"clickaway"!==t&&(z({open:!1,message:""}),setTimeout((function(){return N(!1)}),100))},message:q.message}))}}}]);
//# sourceMappingURL=14.ae47b426.chunk.js.map